このビデオでは、プライベートネットワークを作るために必要なGenesis JSONファイルについてお話したいと思います。
プライベートネットワークの作成に入る前に、このGenesis JSONファイルとは何か、その内容は何かを完全に理解していただきたいと思います。Genesis JSONファイルは、プライベートネットワークを作るためにGo Ethereumが必要とする設定ファイルで、最初のブロック、いわゆるGenesisブロックが作られる際に必要です。
最も重要なのは、このファイルの内容です。ファイルの拡張子が示す通り、これはJSONファイル、つまりJavaScript Object Notationで記述されており、1つのオブジェクトとして書かれています。このオブジェクトにはデータが含まれています。
このファイルにはいくつかの要素があります。最初にお話したいのは、Genesis JSONファイル内のconfigオブジェクトです。これにはチェーンIDが含まれており、現在は15に設定されています。3000や5000など、任意の値に設定できますが、1、2、3は使用できません。なぜなら、1はメインネット、2と3はテストネット用に予約されているからです。私は15に設定していますが、1、2、3以外であれば他の値でも構いません。
次にHomesteadブロックについてです。Ethereumは特定のリリースに分かれています。最初のリリースはFrontierで、現在はHomesteadになっています。当然ながら、これから作成するEthereumブロックチェーンでは、ブロック0からHomesteadを使用したいと思います。
EIPはEthereum Improvement Proposal（Ethereum改善提案）の略で、Ethereumプロトコルにはいくつかの改善がありました。私たちのネットワークでは、両方ともブロック0から開始するようにします。
ブロックチェーンは非常に大きな分散型台帳で、あるアカウントにどれだけのEther（イーサ）が割り当てられたかを記録します。この方法で、Ethereumのプライベートネットワークの最初のブロックを、Etherが事前に割り当てられた状態で作成できます。
この講義では、実際にGo Ethereumとgenesis.jsonファイルを使ってプライベートネットワークを作成する方法についてお話したいと思います。
genesis.jsonファイルを空のディレクトリにダウンロードしました。Shiftキーを押しながらフォルダ内で右クリックすると、コンテキストメニューが開き、「PowerShellウィンドウをここで開く」という選択肢が表示されます。これでWindows上でPowerShellウィンドウが開きます。
MacやLinuxをお使いの場合はさらに簡単です。ターミナルを開いて、genesis.jsonファイルがあるディレクトリに移動するだけです。
gethがインストールされていれば、このようにgethを起動できます。しかし、このまま起動するとメインネットに接続してしまいます。このgenesis.jsonファイルは使用されず、プライベートチェーンのデータディレクトリも使用されません。
そこで、ブロックを保存する新しいディレクトリを作成し、まずその新しいディレクトリをgenesis.jsonファイルで初期化する必要があります。
ここでgethの2つのモードが登場します。gethだけで起動するとgethが通常起動しますが、geth initを使うと新しいディレクトリをgenesis.jsonファイルで初期化できます。ここでは、このディレクトリにあるgenesis.jsonファイルを指定し、--datadirオプションで例えば「mychaindata」というディレクトリ名を指定します。この場合、gethはこの「mychaindata」ディレクトリを作成します。
もし別のディレクトリが表示されたり、正しいディレクトリが表示されない場合は、gethを起動する際のパラメータが正しいことを確認してください。
gethがIPCエンドポイントを開いているのが確認できます。また、gethがブロックの同期を開始しないことも確認できます。これは、基本的に自分だけのネットワーク、つまりプライベートネットワーク上にいるからです。
一度gethを停止しましょう。過去に分かったことですが、gethは同じチェーンIDを持つ別のネットワークと同期を開始してしまうことがあります。これは、gethがディスカバリーモードになっているため、同じチェーンIDを持つ他のノードを見つけると、そのチェーンにあるブロックのダウンロードを開始し、接続してしまうからです。
これは避けたい動作なので、--nodiscoverパラメータを付けてgethを起動します。すると、リスナーは起動しますが、UDPリスナーは起動しなくなります。
このビデオでは、プライベートネットワークの作成方法を学びました。次のビデオでは、実際にこのネットワークを使用していきます。


以下が実際のgethを動かした手順
1. Go Ethereum(geth)のインストール
1.1 リポジトリの追加
    sudo add-apt-repository -y ppa:ethereum/ethereum
1.2 パッケージリストの更新
    sudo apt-get update
1.3 gethのインストール
    sudo apt-get install -y ethereum
1.4 インストールの確認
    geth version

2. genesis.jsonファイルの作成
    genesis.jsonファイルを作成した。

3. 初期化と起動
3.1 初期化
    geth init --datadir mychaindata genesis.json
3.2 起動
    geth --datadir mychaindata --nodiscover --networkid 15 console

4. 動作確認(gethコンソール内で実行)
// ブロック番号の確認（0が表示されるはず）
eth.blockNumber

// ネットワークIDの確認
net.version

// 同期状態の確認（falseが表示される = 同期していない）
eth.syncing

// 終了
exit

5. (補足)バックグラウンドで起動する場合
# バックグラウンドで起動
nohup geth --datadir mychaindata --nodiscover --networkid 15 &

# 後からコンソールに接続
geth attach mychaindata/geth.ipc